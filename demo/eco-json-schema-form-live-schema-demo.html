<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="../../polymer/lib/elements/dom-if.html"/>
<link rel="import" href="../../polymer/lib/elements/dom-repeat.html"/>
<link rel="import" href="../../polymer/lib/elements/custom-style.html"/>
<link rel="import" href="../../polymer/lib/elements/dom-module.html"/>
<link rel="import" href="../../polymer/lib/elements/dom-bind.html"/>
<link rel="import" href="../../polymer/lib/elements/array-selector.html"/>

<link rel="import" href="../../iron-flex-layout/iron-flex-layout-classes.html" />

<link rel="import" href="../eco-json-schema-object.html" />

<script src="../../ace-builds/src/ace.js"></script>
<link href="../../jsoneditor/dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
<script src="../../jsoneditor/dist/jsoneditor.min.js"></script>
<script src="schema.js"></script>

<dom-module id="eco-json-schema-form-live-schema-demo">

  <link rel="import" href="../../paper-material/paper-material.html" />

  <link rel="import" href="../eco-json-schema-wizard.html" />

  <template>

  <custom-style include="iron-flex iron-flex-alignment">
    <style>
    :host > div {
      display: flex;
    }
    paper-material {
      background: #ffffff;
      height: 100%;
    }

    paper-material,
    paper-material>* {
      margin: 10px;
    }

    .editor-container {
      height: 600px;
    }

    #jsoneditor {
      width: 400px;
      height: 93%;
    }
    eco-json-schema-wizard {
      width: 400px;
      height: 93%;
    }
  </style>
</custom-style>


    <!--TODO:  Removing the editors/values etc facing lot of issues. Nothing is showing up and no errors on page. Can be added later-->
    <eco-json-schema-object id="jsonObject"></eco-json-schema-object>

  </template>
  <script>

    class EcoJsonSchemaFormLiveDemo extends Polymer.Element {
      static get is() {
        return 'eco-json-schema-form-live-schema-demo';
      }

      connectedCallback() {
        super.connectedCallback();
        this._schema = demoSchema;

        this.schema = JSON.parse(JSON.stringify(this._schema));
        this.$.jsonObject.schema = this.schema;
      }


      /*static get properties() {
        return {
          language: {
            value: 'en',
            notify: true
          },
          resources: {
            value: function () {
              return {
                'en': {'prev': 'Previous', 'next': 'Next', 'submit': 'Submit', 'add-image': 'Click to select an image'},
                'es': {
                  'prev': 'Anterior',
                  'next': 'Siguiente',
                  'submit': 'Enviar',
                  'add-image': 'Click para adicionar una imagen'
                }
              }
            }
          },
          schema: {
            type: Object,
            notify: true,
            value: {
              'schema': {}
            }
          },
          value: {
            type: Object,
            notify: true,
            value: {}
          },
          page: {
            type: Object,
            notify: true,
          },
          pages: {
            type: Object,
            notify: true,
          }
        }
      }

      connectedCallback() {
        super.connectedCallback();


        this._schema = demoSchema;

//        this.value =          {
//          names : ['Schwartz\'s'],
//          address : '3895 Saint Laurent Boulevard',
//          city : 'Montreal',
//          province : 'QC',
//          country : 'Canada',
//          postalCode : 'H2W1X9',
//          phoneNumbers : [
//            {
//              type: 'Main',
//              phoneNumber: '(514) 842-4813'
//            },
//            {
//              type: 'Office',
//              phoneNumber: '(514) 842-4813'
//            }
//          ],
//          websites : ['http://www.schwartzsdeli.com/'],
//          geo : [
//            -73.577675,
//            45.516201
//          ],
//          establishedDate : new Date('2015-09-14T17:50:32.493Z')
//        };

        this.schema = JSON.parse(JSON.stringify(this._schema));

        var editorOpts = {
          mode: 'code',
          change: this._schemaChanged.bind(this)
        };

        this.editor = new JSONEditor(this.$.jsoneditor, editorOpts, this._schema);
      }

      _schemaChanged() {
        if (!this.editor) {
          console.log('Editor is false');
        } else {
          try {
            var json = JSON.parse(this.editor.getText());
            this.schema = json;
          } catch (e) {
            // bad, bad json
          }
        }
      }

      _valueChanged() {
        var json = JSON.stringify(this.value, null, ' ');
        this.$.valueText.innerHTML = json;
      }*/
    }
  window.customElements.define(EcoJsonSchemaFormLiveDemo.is, EcoJsonSchemaFormLiveDemo);
  </script>
</dom-module>
